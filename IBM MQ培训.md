# IBM MQ培训

Day 1 20200824 9:30 - 16:30 zhangcheng Consulting It specilist

举例中间件：kafka、MQ、rabbit MQ等；

MQ 本质上是异步处理软件；

MQ和MQ之间的传递；

MQ强调形成一个网络，而不是一个server；

IBM MQ 优势：多个MQ server之间传递；

不同版本的IBM MQ之间互联互通没有问题；

MQ优先级概念：基于优先级的先进先出；（每一个都有优先级的字段）

MQ使用场景：

1. 消息通知、数据发送（有去无回）

2. 请求/应答模式（有去有回）

   去的消息和回的消息是完全没有关系的，但是有同步应答功能，通过IBM、人工，通过message的ID捆绑，例如发送ID和接收ID绑定；

3. 信息发布和订阅（股票交易、天气预报等等场景）（谁订阅谁收到）

   通过主题来区分，通过区分主题来预订、接收数据；

   1. 不知道使用者或者订阅者是谁，但是会发布到主题队列中去；例如：人民银行，外部数据发布过来，希望从原来1个系统接收到多个系统的接收，只要修改IBM MQ配置即可；
   2. （待补充）

## MQ基本概念

- 理解成一个数据库；操作仅get（delete）、put（insert），API中也仅这两类；
- C/S架构，都只做2件事情：发送mq，接收mq；
- MQ message queue 存放数据的容器；
- 通道：MQ**与外部打交道的配置对象**；
- MQ不管放置内容、结构等；
- 创建队列管理器、通道、
- **APP通过*客户机服务器的通道*与MQ通道打交道；**
- app处理的是消息内容，不包含消息头（MQ使用的消息结构、属性attr.）

## MQ的工作机制：存储转发机制

MQ缓存队列，有缓存、数据日志；均写在本地；

MQ消息结构：


$$
Message headers + Message Properties + Message Data = MQ
$$
消息物理上限：缺省 4MB，最大100MB；

队列深度、队列大小：（创建MQ时，要指定硬盘空间、队列存放大小）

1. 发送即取走，此时深度可为0；
2. 队列深度由 消息总量/消息单个体量=消息数量 限制；实际情况也有计算结果以外的情况，例如设置999，可能并不够；

------

消息超时

消息可以永远存放；也可以从正常队列放入超时队列，通过消息头来定义、配置；

**消息的持久性：**（也即是否可恢复）

- MQ记不记日志的区别；默认MQ存放在内存中，记日志后，消息具有持久性，反之则断电后不会对消息进行恢复；
- MQ队列最大buffer：2M
- 队列文件可大可小，队列文件会带一段内存；
- 队列文件是临时的，日志文件是永久的；

**消息优先级：**

0 - 9 9最高；

## **队列 Queues**

1. **本地队列**

2. **远程队列（另外一个MQ的别名、映射）**

3. **传输队列**（系统内部队列，**系统管理员要求关注**）

   传输队列的堵塞（堆积正常情况为0）：网络断、对方服务没有启用、

4. **MQI 通道是双向的，APP到MQ的通道；但是MQ到另一个MQ，要定义两个通道（发送、接收通道）；**

5. 

## MQ安装（windows、linux）

linux 内核参数要求：

MQM用户组



## MQ安全控制

1.用户权限

2.加密 ssl

Trigger 触发

## MQ 编程API

### 函数原型

1. connect disconnect
2. open close
3. put get

rest api、java api等；